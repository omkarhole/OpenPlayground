<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Silence Game</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root{
  --bg:#020617;
  --panel:#0b1220;
  --text:#e5e7eb;
  --danger:#ef4444;
  --warn:#f59e0b;
  --safe:#22c55e;
}

*{box-sizing:border-box;font-family:system-ui;}

body{
  margin:0;
  background:radial-gradient(circle at top,#0f172a,#020617);
  color:var(--text);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.game{
  width:95%;
  max-width:420px;
  background:var(--panel);
  padding:26px;
  border-radius:18px;
  text-align:center;
  box-shadow:0 30px 80px rgba(0,0,0,.7);
}

h1{margin-bottom:6px;}
.sub{font-size:.9rem;color:#94a3b8;margin-bottom:14px;}

.meter{
  height:12px;
  background:#020617;
  border-radius:10px;
  overflow:hidden;
  margin:14px 0;
}
.meter-fill{
  height:100%;
  width:0%;
  background:var(--safe);
  transition:.1s;
}

.time{
  font-size:1.2rem;
  margin-top:6px;
}

.taunt{
  margin-top:14px;
  font-size:.9rem;
  color:#fca5a5;
  min-height:22px;
}

.over{
  display:none;
  margin-top:18px;
}

button{
  margin-top:14px;
  padding:10px 18px;
  border:none;
  border-radius:10px;
  background:linear-gradient(135deg,#2563eb,#3b82f6);
  color:white;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="game">
  <h1>ü§´ SILENCE GAME</h1>
  <div class="sub">Do not speak. Do not react. Do not make a sound.</div>

  <div class="meter">
    <div class="meter-fill" id="volume"></div>
  </div>

  <div class="time">
    Silence Time: <span id="time">0.0</span>s
  </div>

  <div class="taunt" id="taunt"></div>

  <div class="over" id="over">
    <div id="reason"></div>
    <button onclick="restart()">Try Again</button>
  </div>
</div>

<audio id="stress" loop>
  <source src="https://cdn.pixabay.com/download/audio/2022/02/23/audio_1a6f0d8c89.mp3" type="audio/mpeg">
</audio>

<script>
const volumeBar=document.getElementById("volume");
const timeEl=document.getElementById("time");
const tauntEl=document.getElementById("taunt");
const over=document.getElementById("over");
const reasonEl=document.getElementById("reason");
const stress=document.getElementById("stress");

let start=Date.now();
let active=true;
let threshold=18;

const taunts=[
  "You can talk. No one will know.",
  "Was that a breath?",
  "Smile. Laugh. Just once.",
  "Almost over‚Ä¶ or is it?",
  "Your mic is still on.",
  "People usually fail now.",
  "Coughing counts.",
  "You‚Äôre doing too well."
];

navigator.mediaDevices.getUserMedia({audio:true})
.then(stream=>{
  const ctx=new AudioContext();
  const mic=ctx.createMediaStreamSource(stream);
  const analyser=ctx.createAnalyser();
  mic.connect(analyser);
  const data=new Uint8Array(analyser.frequencyBinCount);

  stress.play();

  setInterval(()=>{
    if(!active) return;

    analyser.getByteFrequencyData(data);
    const avg=data.reduce((a,b)=>a+b,0)/data.length;

    volumeBar.style.width=Math.min(avg*2,100)+"%";
    volumeBar.style.background=
      avg<threshold? "var(--safe)" :
      avg<threshold*1.3? "var(--warn)" :
      "var(--danger)";

    if(avg>threshold*1.5){
      end("Sound detected");
    }
  },100);
})
.catch(()=>{
  end("Microphone access denied");
});

document.addEventListener("visibilitychange",()=>{
  if(document.hidden) end("You looked away");
});

setInterval(()=>{
  if(!active) return;
  timeEl.textContent=((Date.now()-start)/1000).toFixed(1);
},100);

setInterval(()=>{
  if(!active) return;
  tauntEl.textContent=taunts[Math.floor(Math.random()*taunts.length)];
},3000);

function end(msg){
  if(!active) return;
  active=false;
  stress.pause();
  reasonEl.textContent="‚ùå "+msg;
  over.style.display="block";

  const best=Math.max(
    Number(localStorage.getItem("silenceBest")||0),
    Number(timeEl.textContent)
  );
  localStorage.setItem("silenceBest",best);

  tauntEl.innerHTML=`Best Silence: ${best}s`;
}

function restart(){location.reload();}
</script>
</body>
</html>
