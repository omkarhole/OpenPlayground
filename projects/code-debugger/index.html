<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Code Debugger Playground</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #e8ffd0;
            color: #e2e8f0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1600px;
            width: 100%;
            margin: 0 auto;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px;
            background: rgba(30, 41, 59, 0.7);
            border-radius: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            overflow: hidden;
        }
        
        header::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(56, 189, 248, 0.1) 0%, transparent 50%),
                radial-gradient(circle at 80% 70%, rgba(139, 92, 246, 0.1) 0%, transparent 50%);
            z-index: 0;
        }
        
        h1 {
            font-size: 3.2rem;
            margin-bottom: 10px;
            background: linear-gradient(to right, #38bdf8, #8b5cf6);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            position: relative;
            z-index: 1;
        }
        
        .tagline {
            font-size: 1.2rem;
            color: #94a3b8;
            margin-bottom: 15px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
            position: relative;
            z-index: 1;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
            min-height: 700px;
        }
        
        @media (max-width: 1200px) {
            .main-content {
                grid-template-columns: 1fr;
            }
        }
        
        .code-editor-panel, .debugger-panel {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .panel-title {
            font-size: 1.8rem;
            color: #38bdf8;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .code-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }
        
        .code-tab {
            padding: 10px 20px;
            background: rgba(30, 41, 59, 0.8);
            border: 1px solid rgba(148, 163, 184, 0.3);
            border-radius: 10px 10px 0 0;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .code-tab:hover {
            background: rgba(56, 189, 248, 0.1);
            color: #e2e8f0;
        }
        
        .code-tab.active {
            background: rgba(56, 189, 248, 0.2);
            color: #38bdf8;
            border-bottom: 2px solid #38bdf8;
        }
        
        .editor-container {
            flex: 1;
            background: #0f172a;
            border-radius: 15px;
            overflow: hidden;
            border: 1px solid rgba(148, 163, 184, 0.3);
            position: relative;
        }
        
        .editor-header {
            background: #1e293b;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .file-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: #94a3b8;
        }
        
        .editor-controls {
            display: flex;
            gap: 10px;
        }
        
        .editor-control-btn {
            padding: 8px 15px;
            background: rgba(56, 189, 248, 0.1);
            border: 1px solid rgba(56, 189, 248, 0.3);
            border-radius: 8px;
            color: #38bdf8;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.9rem;
        }
        
        .editor-control-btn:hover {
            background: rgba(56, 189, 248, 0.2);
        }
        
        .code-area {
            padding: 20px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 1rem;
            line-height: 1.5;
            min-height: 400px;
            max-height: 500px;
            overflow-y: auto;
            white-space: pre;
            tab-size: 2;
            background: #0f172a;
            color: #e2e8f0;
        }
        
        .code-area:focus {
            outline: none;
        }
        
        .line-number {
            color: #64748b;
            margin-right: 20px;
            user-select: none;
        }
        
        .error-line {
            background: rgba(239, 68, 68, 0.2);
            border-left: 3px solid #ef4444;
            padding-left: 10px;
        }
        
        .warning-line {
            background: rgba(245, 158, 11, 0.2);
            border-left: 3px solid #f59e0b;
            padding-left: 10px;
        }
        
        .success-line {
            background: rgba(34, 197, 94, 0.2);
            border-left: 3px solid #22c55e;
            padding-left: 10px;
        }
        
        .debug-info {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .debug-info-title {
            font-size: 1.3rem;
            color: #8b5cf6;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .debug-info-content {
            color: #cbd5e1;
            line-height: 1.6;
        }
        
        .debug-controls {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap;
        }
        
        button {
            padding: 15px 25px;
            font-size: 1rem;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        
        .btn-run {
            background: linear-gradient(to right, #38bdf8, #0ea5e9);
            color: white;
        }
        
        .btn-debug {
            background: linear-gradient(to right, #8b5cf6, #7c3aed);
            color: white;
        }
        
        .btn-fix {
            background: linear-gradient(to right, #10b981, #059669);
            color: white;
        }
        
        .btn-reset {
            background: linear-gradient(to right, #f59e0b, #d97706);
            color: white;
        }
        
        .btn-ai {
            background: linear-gradient(to right, #ec4899, #db2777);
            color: white;
        }
        
        button:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        button:active {
            transform: translateY(0);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .ai-suggestions {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 25px;
            margin-top: 25px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            display: none;
        }
        
        .ai-suggestions.active {
            display: block;
        }
        
        .ai-suggestion-title {
            font-size: 1.3rem;
            color: #ec4899;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .ai-suggestion {
            background: rgba(236, 72, 153, 0.1);
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 15px;
            border-left: 3px solid #ec4899;
        }
        
        .suggestion-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .suggestion-title {
            font-weight: 600;
            color: #ec4899;
        }
        
        .confidence {
            font-size: 0.9rem;
            color: #94a3b8;
            background: rgba(148, 163, 184, 0.1);
            padding: 5px 10px;
            border-radius: 20px;
        }
        
        .suggestion-desc {
            color: #cbd5e1;
            line-height: 1.5;
            margin-bottom: 15px;
        }
        
        .suggestion-code {
            background: #0f172a;
            border-radius: 8px;
            padding: 15px;
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            margin-bottom: 15px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .suggestion-actions {
            display: flex;
            gap: 10px;
        }
        
        .suggestion-btn {
            padding: 8px 15px;
            font-size: 0.9rem;
            border-radius: 8px;
            cursor: pointer;
        }
        
        .suggestion-btn.apply {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
            border: 1px solid rgba(34, 197, 94, 0.3);
        }
        
        .suggestion-btn.explain {
            background: rgba(56, 189, 248, 0.2);
            color: #38bdf8;
            border: 1px solid rgba(56, 189, 248, 0.3);
        }
        
        .debug-console {
            background: #0f172a;
            border-radius: 15px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            flex: 1;
            overflow-y: auto;
            max-height: 300px;
        }
        
        .console-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            color: #94a3b8;
        }
        
        .console-content {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        
        .console-line {
            margin-bottom: 8px;
            padding-left: 10px;
            border-left: 2px solid transparent;
        }
        
        .console-error {
            color: #ef4444;
            border-left-color: #ef4444;
        }
        
        .console-warning {
            color: #f59e0b;
            border-left-color: #f59e0b;
        }
        
        .console-info {
            color: #38bdf8;
            border-left-color: #38bdf8;
        }
        
        .console-success {
            color: #22c55e;
            border-left-color: #22c55e;
        }
        
        .variables-panel {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 25px;
        }
        
        .variable-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 15px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .variable-name {
            font-size: 0.9rem;
            color: #94a3b8;
            margin-bottom: 5px;
        }
        
        .variable-value {
            font-family: 'Monaco', 'Courier New', monospace;
            font-size: 1rem;
            color: #e2e8f0;
            word-break: break-all;
        }
        
        .variable-type {
            font-size: 0.8rem;
            color: #8b5cf6;
            margin-top: 5px;
        }
        
        .call-stack {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 10px;
            padding: 20px;
            margin-top: 25px;
            border: 1px solid rgba(148, 163, 184, 0.2);
        }
        
        .stack-title {
            font-size: 1.1rem;
            color: #38bdf8;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .stack-frame {
            background: rgba(15, 23, 42, 0.8);
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 3px solid #38bdf8;
        }
        
        .frame-function {
            font-weight: 600;
            color: #e2e8f0;
            margin-bottom: 5px;
        }
        
        .frame-location {
            font-size: 0.9rem;
            color: #94a3b8;
        }
        
        .exercises-panel {
            background: rgba(30, 41, 59, 0.7);
            border-radius: 20px;
            padding: 30px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(148, 163, 184, 0.2);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            margin-bottom: 30px;
        }
        
        .exercises-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .exercise-card {
            background: rgba(30, 41, 59, 0.8);
            border-radius: 15px;
            padding: 25px;
            border: 1px solid rgba(148, 163, 184, 0.2);
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .exercise-card:hover {
            transform: translateY(-5px);
            border-color: rgba(56, 189, 248, 0.5);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }
        
        .exercise-difficulty {
            display: inline-block;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-bottom: 15px;
        }
        
        .difficulty-easy {
            background: rgba(34, 197, 94, 0.2);
            color: #22c55e;
        }
        
        .difficulty-medium {
            background: rgba(245, 158, 11, 0.2);
            color: #f59e0b;
        }
        
        .difficulty-hard {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
        }
        
        .exercise-title {
            font-size: 1.3rem;
            color: #e2e8f0;
            margin-bottom: 10px;
        }
        
        .exercise-desc {
            color: #94a3b8;
            line-height: 1.5;
            margin-bottom: 20px;
        }
        
        .exercise-stats {
            display: flex;
            justify-content: space-between;
            color: #64748b;
            font-size: 0.9rem;
        }
        
        footer {
            text-align: center;
            padding: 30px;
            color: #94a3b8;
            margin-top: 30px;
            font-size: 0.9rem;
            border-top: 1px solid rgba(148, 163, 184, 0.1);
        }
        
        .error-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s;
            max-width: 400px;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .success-popup {
            position: fixed;
            top: 20px;
            right: 20px;
            background: rgba(34, 197, 94, 0.9);
            color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
            z-index: 1000;
            display: none;
            animation: slideIn 0.3s;
            max-width: 400px;
        }
        
        .loader {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #38bdf8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }
            
            .main-content {
                grid-template-columns: 1fr;
            }
            
            .debug-controls {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .exercises-grid {
                grid-template-columns: 1fr;
            }
            
            .variables-panel {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1><i class="fas fa-robot"></i> AI Code Debugger Playground</h1>
            <p class="tagline">Interactive debugging assistant with AI-powered error explanations, fix suggestions, and step-by-step debugging visualizations.</p>
        </header>
        
        <div class="main-content">
            <div class="code-editor-panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-code"></i> Code Editor</h2>
                    <div class="code-tabs">
                        <div class="code-tab active" data-file="buggy.js">buggy.js</div>
                        <div class="code-tab" data-file="utils.js">utils.js</div>
                        <div class="code-tab" data-file="test.js">test.js</div>
                    </div>
                </div>
                
                <div class="editor-container">
                    <div class="editor-header">
                        <div class="file-info">
                            <i class="fas fa-file-code"></i>
                            <span id="currentFileName">buggy.js</span>
                            <span class="language-badge">JavaScript</span>
                        </div>
                        <div class="editor-controls">
                            <button class="editor-control-btn" id="formatBtn">
                                <i class="fas fa-indent"></i> Format
                            </button>
                            <button class="editor-control-btn" id="saveBtn">
                                <i class="fas fa-save"></i> Save
                            </button>
                        </div>
                    </div>
                    
                    <div class="code-area" id="codeEditor" contenteditable="true" spellcheck="false">
                        <!-- Code will be loaded here -->
                    </div>
                </div>
                
                <div class="debug-controls">
                    <button class="btn-run" id="runBtn">
                        <i class="fas fa-play"></i> Run Code
                    </button>
                    <button class="btn-debug" id="debugBtn">
                        <i class="fas fa-bug"></i> Start Debugging
                    </button>
                    <button class="btn-ai" id="aiHelpBtn">
                        <i class="fas fa-robot"></i> AI Help
                    </button>
                    <button class="btn-fix" id="fixBtn">
                        <i class="fas fa-magic"></i> Auto-Fix
                    </button>
                    <button class="btn-reset" id="resetBtn">
                        <i class="fas fa-redo"></i> Reset
                    </button>
                </div>
                
                <div class="ai-suggestions" id="aiSuggestions">
                    <h3 class="ai-suggestion-title"><i class="fas fa-lightbulb"></i> AI Suggestions</h3>
                    <div id="suggestionsList">
                        <!-- AI suggestions will be added here -->
                    </div>
                </div>
            </div>
            
            <div class="debugger-panel">
                <div class="panel-header">
                    <h2 class="panel-title"><i class="fas fa-search"></i> Debugger</h2>
                </div>
                
                <div class="debug-console">
                    <div class="console-header">
                        <span><i class="fas fa-terminal"></i> Console Output</span>
                        <button class="editor-control-btn" id="clearConsoleBtn">
                            <i class="fas fa-trash"></i> Clear
                        </button>
                    </div>
                    <div class="console-content" id="consoleOutput">
                        <!-- Console output will appear here -->
                    </div>
                </div>
                
                <div class="variables-panel" id="variablesPanel">
                    <!-- Variables will be added here -->
                </div>
                
                <div class="call-stack">
                    <h3 class="stack-title"><i class="fas fa-layer-group"></i> Call Stack</h3>
                    <div id="callStackContent">
                        <!-- Call stack frames will be added here -->
                    </div>
                </div>
                
                <div class="debug-info" id="debugInfo">
                    <h3 class="debug-info-title"><i class="fas fa-info-circle"></i> Debug Information</h3>
                    <div class="debug-info-content" id="debugInfoContent">
                        Click "Run Code" or "Start Debugging" to see debug information here.
                    </div>
                </div>
            </div>
        </div>
        
        <div class="exercises-panel">
            <h2 class="panel-title"><i class="fas fa-graduation-cap"></i> Debugging Exercises</h2>
            <p class="tagline" style="margin-top: 10px; margin-bottom: 0;">Practice debugging with these common coding problems. Click an exercise to load it into the editor.</p>
            
            <div class="exercises-grid" id="exercisesGrid">
                <!-- Exercises will be loaded here -->
            </div>
        </div>
        
        <footer>
            <p>AI Code Debugger Playground &copy; 2026 | Interactive debugging assistant for learning and practicing code debugging skills</p>
            <p>Note: This is a simulation. Real AI debugging would require integration with actual AI models.</p>
        </footer>
    </div>
    
    <!-- Popups -->
    <div class="error-popup" id="errorPopup">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
            <h3 style="font-size: 1.2rem;"><i class="fas fa-exclamation-circle"></i> Runtime Error</h3>
            <button style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;" id="closeErrorBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="errorMessage"></div>
    </div>
    
    <div class="success-popup" id="successPopup">
        <div style="display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 10px;">
            <h3 style="font-size: 1.2rem;"><i class="fas fa-check-circle"></i> Success!</h3>
            <button style="background: none; border: none; color: white; cursor: pointer; font-size: 1.2rem;" id="closeSuccessBtn">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div id="successMessage"></div>
    </div>

    <script>
        // DOM Elements
        const codeEditor = document.getElementById('codeEditor');
        const consoleOutput = document.getElementById('consoleOutput');
        const variablesPanel = document.getElementById('variablesPanel');
        const callStackContent = document.getElementById('callStackContent');
        const debugInfoContent = document.getElementById('debugInfoContent');
        const aiSuggestions = document.getElementById('aiSuggestions');
        const suggestionsList = document.getElementById('suggestionsList');
        const exercisesGrid = document.getElementById('exercisesGrid');
        const errorPopup = document.getElementById('errorPopup');
        const errorMessage = document.getElementById('errorMessage');
        const successPopup = document.getElementById('successPopup');
        const successMessage = document.getElementById('successMessage');
        
        // Buttons
        const runBtn = document.getElementById('runBtn');
        const debugBtn = document.getElementById('debugBtn');
        const aiHelpBtn = document.getElementById('aiHelpBtn');
        const fixBtn = document.getElementById('fixBtn');
        const resetBtn = document.getElementById('resetBtn');
        const formatBtn = document.getElementById('formatBtn');
        const saveBtn = document.getElementById('saveBtn');
        const clearConsoleBtn = document.getElementById('clearConsoleBtn');
        const closeErrorBtn = document.getElementById('closeErrorBtn');
        const closeSuccessBtn = document.getElementById('closeSuccessBtn');
        const codeTabs = document.querySelectorAll('.code-tab');
        
        // Application state
        let currentFile = 'buggy.js';
        let isDebugging = false;
        let currentExercise = null;
        let variables = {};
        let callStack = [];
        let breakpoints = [];
        let currentLine = 0;
        
        // Code examples for different files
        const codeFiles = {
            'buggy.js': `// Buggy JavaScript Code - Can you find and fix all the bugs?

function calculateDiscount(price, discountPercent) {
    // Bug 1: Missing check for invalid inputs
    return price - (price * discountPercent);
}

function processOrder(items, taxRate) {
    let subtotal = 0;
    
    // Bug 2: Using var instead of let causes scope issues
    for (var i = 0; i < items.length; i++) {
        subtotal += items[i].price * items[i].quantity;
    }
    
    let tax = subtotal * taxRate;
    let total = subtotal + tax;
    
    // Bug 3: Not rounding to 2 decimal places
    return total;
}

function validateUser(user) {
    // Bug 4: Incorrect condition - should be AND not OR
    if (!user.name || !user.email || !user.age) {
        return false;
    }
    
    // Bug 5: Missing type check
    if (user.age < 18) {
        return "User must be 18 or older";
    }
    
    return true;
}

function findMax(numbers) {
    // Bug 6: Should initialize with first element or -Infinity
    let max = 0;
    
    for (let i = 0; i < numbers.length; i++) {
        if (numbers[i] > max) {
            max = numbers[i];
        }
    }
    
    return max;
}

function formatDate(dateString) {
    // Bug 7: Incorrect date parsing
    const date = new Date(dateString);
    
    // Bug 8: getMonth() returns 0-11, not 1-12
    return \`\${date.getMonth()}/\${date.getDate()}/\${date.getFullYear()}\`;
}

// Test the functions
console.log("Testing calculateDiscount:");
console.log("100 with 20% discount:", calculateDiscount(100, 20)); // Should be 80

console.log("\\nTesting processOrder:");
const items = [
    { name: "Book", price: 15.99, quantity: 2 },
    { name: "Pen", price: 1.99, quantity: 5 }
];
console.log("Order total:", processOrder(items, 0.08)); // Should be ~41.37

console.log("\\nTesting validateUser:");
const user = { name: "John", email: "john@example.com", age: 25 };
console.log("Valid user?", validateUser(user));

console.log("\\nTesting findMax:");
const numbers = [5, 8, 2, 10, 3];
console.log("Maximum value:", findMax(numbers)); // Should be 10

console.log("\\nTesting formatDate:");
console.log("Formatted date:", formatDate("2023-05-15")); // Should be 5/15/2023`,
            
            'utils.js': `// Utility functions with potential issues

function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    };
}

function deepClone(obj) {
    // Simple deep clone - has issues with circular references
    return JSON.parse(JSON.stringify(obj));
}

function memoize(fn) {
    const cache = {};
    return function(...args) {
        const key = JSON.stringify(args);
        if (cache[key]) {
            return cache[key];
        }
        const result = fn.apply(this, args);
        cache[key] = result;
        return result;
    };
}`,
            
            'test.js': `// Test cases for the buggy functions

function runTests() {
    console.log("Running tests...");
    
    // Test calculateDiscount
    try {
        const result = calculateDiscount(100, 0.2);
        if (result !== 80) {
            console.error("FAIL: calculateDiscount(100, 0.2) should return 80, got", result);
        } else {
            console.log("PASS: calculateDiscount");
        }
    } catch (error) {
        console.error("ERROR in calculateDiscount:", error.message);
    }
    
    // Test findMax with negative numbers
    try {
        const result = findMax([-5, -2, -10]);
        if (result !== -2) {
            console.error("FAIL: findMax with negatives should return -2, got", result);
        } else {
            console.log("PASS: findMax with negatives");
        }
    } catch (error) {
        console.error("ERROR in findMax:", error.message);
    }
    
    // Test validateUser with invalid data
    try {
        const invalidUser = { name: "", email: "test", age: 15 };
        const result = validateUser(invalidUser);
        if (result !== false) {
            console.error("FAIL: validateUser should return false for empty name");
        } else {
            console.log("PASS: validateUser validation");
        }
    } catch (error) {
        console.error("ERROR in validateUser:", error.message);
    }
}

// Run tests when this file is executed
runTests();`
        };
        
        // Debugging exercises
        const exercises = [
            {
                id: 1,
                title: "Discount Calculation Bug",
                description: "The calculateDiscount function doesn't apply discount correctly. It should multiply by discountPercent/100.",
                difficulty: "easy",
                code: `function calculateDiscount(price, discountPercent) {
    return price - (price * discountPercent);
}

// Test
console.log("100 with 20% discount:", calculateDiscount(100, 20)); // Should be 80, but gives -1900`,
                hints: [
                    "The discountPercent parameter should be divided by 100",
                    "Check if the function handles percentage correctly"
                ],
                solution: `function calculateDiscount(price, discountPercent) {
    // Convert percentage to decimal
    return price - (price * (discountPercent / 100));
}`
            },
            {
                id: 2,
                title: "Array Maximum Finder",
                description: "The findMax function fails with negative numbers. Find and fix the initialization bug.",
                difficulty: "easy",
                code: `function findMax(numbers) {
    let max = 0;
    
    for (let i = 0; i < numbers.length; i++) {
        if (numbers[i] > max) {
            max = numbers[i];
        }
    }
    
    return max;
}

// Test with negative numbers
console.log("Max of [-5, -2, -10]:", findMax([-5, -2, -10])); // Should be -2, but returns 0`,
                hints: [
                    "What happens when all numbers are negative?",
                    "Initialize max with the first element or -Infinity"
                ],
                solution: `function findMax(numbers) {
    if (numbers.length === 0) return undefined;
    
    let max = numbers[0];
    
    for (let i = 1; i < numbers.length; i++) {
        if (numbers[i] > max) {
            max = numbers[i];
        }
    }
    
    return max;
}`
            },
            {
                id: 3,
                title: "Date Formatting Issue",
                description: "The formatDate function shows incorrect month. JavaScript months are 0-indexed.",
                difficulty: "medium",
                code: `function formatDate(dateString) {
    const date = new Date(dateString);
    return \`\${date.getMonth()}/\${date.getDate()}/\${date.getFullYear()}\`;
}

console.log("2023-05-15 formatted:", formatDate("2023-05-15")); // Shows 4/15/2023 instead of 5/15/2023`,
                hints: [
                    "Check JavaScript Date.getMonth() documentation",
                    "Months are 0-indexed (0 = January, 11 = December)"
                ],
                solution: `function formatDate(dateString) {
    const date = new Date(dateString);
    // getMonth() returns 0-11, so add 1 for correct month
    return \`\${date.getMonth() + 1}/\${date.getDate()}/\${date.getFullYear()}\`;
}`
            },
            {
                id: 4,
                title: "User Validation Logic",
                description: "The validation logic has incorrect condition and missing type checks.",
                difficulty: "medium",
                code: `function validateUser(user) {
    if (!user.name || !user.email || !user.age) {
        return false;
    }
    
    if (user.age < 18) {
        return "User must be 18 or older";
    }
    
    return true;
}

// Tests
console.log("Valid user:", validateUser({name: "John", email: "john@test", age: "25"})); // Should validate type
console.log("Underage:", validateUser({name: "Jane", email: "jane@test", age: 16}));`,
                hints: [
                    "Check if age is a number, not just truthy",
                    "The condition should validate all fields exist"
                ],
                solution: `function validateUser(user) {
    if (!user.name || !user.email || user.age === undefined || user.age === null) {
        return false;
    }
    
    // Ensure age is a number
    if (typeof user.age !== 'number' || isNaN(user.age)) {
        return "Age must be a valid number";
    }
    
    if (user.age < 18) {
        return "User must be 18 or older";
    }
    
    return true;
}`
            },
            {
                id: 5,
                title: "Order Processing with Tax",
                description: "Multiple bugs: variable scope, missing rounding, and potential floating point errors.",
                difficulty: "hard",
                code: `function processOrder(items, taxRate) {
    let subtotal = 0;
    
    for (var i = 0; i < items.length; i++) {
        subtotal += items[i].price * items[i].quantity;
    }
    
    let tax = subtotal * taxRate;
    let total = subtotal + tax;
    
    return total;
}

// Test
const items = [
    { name: "Book", price: 15.99, quantity: 2 },
    { name: "Pen", price: 1.99, quantity: 5 }
];
console.log("Order total:", processOrder(items, 0.08)); // Should be 41.37`,
                hints: [
                    "Use let instead of var in loop",
                    "Round to 2 decimal places for currency",
                    "Consider floating point precision"
                ],
                solution: `function processOrder(items, taxRate) {
    let subtotal = 0;
    
    for (let i = 0; i < items.length; i++) {
        subtotal += items[i].price * items[i].quantity;
    }
    
    // Round to avoid floating point errors
    subtotal = Math.round(subtotal * 100) / 100;
    
    let tax = subtotal * taxRate;
    tax = Math.round(tax * 100) / 100;
    
    let total = subtotal + tax;
    total = Math.round(total * 100) / 100;
    
    return total;
}`
            }
        ];
        
        // Initialize the debugger
        function init() {
            // Load initial code
            loadFile(currentFile);
            
            // Load exercises
            loadExercises();
            
            // Set up event listeners
            setupEventListeners();
            
            // Initialize console
            addConsoleMessage("AI Debugger Playground initialized. Select an exercise or edit the code to begin.", "info");
        }
        
        // Load a file into the editor
        function loadFile(filename) {
            currentFile = filename;
            codeEditor.textContent = codeFiles[filename];
            
            // Update UI
            document.getElementById('currentFileName').textContent = filename;
            
            // Update active tab
            codeTabs.forEach(tab => {
                if (tab.dataset.file === filename) {
                    tab.classList.add('active');
                } else {
                    tab.classList.remove('active');
                }
            });
            
            // Reset debugging state
            resetDebuggingState();
            
            // Highlight potential errors
            highlightPotentialErrors();
        }
        
        // Load exercises into the grid
        function loadExercises() {
            exercisesGrid.innerHTML = '';
            
            exercises.forEach(exercise => {
                const exerciseCard = document.createElement('div');
                exerciseCard.className = 'exercise-card';
                exerciseCard.dataset.id = exercise.id;
                
                exerciseCard.innerHTML = `
                    <div class="exercise-difficulty difficulty-${exercise.difficulty}">
                        ${exercise.difficulty.charAt(0).toUpperCase() + exercise.difficulty.slice(1)}
                    </div>
                    <h3 class="exercise-title">${exercise.title}</h3>
                    <p class="exercise-desc">${exercise.description}</p>
                    <div class="exercise-stats">
                        <span><i class="fas fa-bug"></i> ${exercise.hints.length} hints available</span>
                        <span><i class="fas fa-code"></i> JavaScript</span>
                    </div>
                `;
                
                exerciseCard.addEventListener('click', () => loadExercise(exercise.id));
                
                exercisesGrid.appendChild(exerciseCard);
            });
        }
        
        // Load an exercise into the editor
        function loadExercise(id) {
            const exercise = exercises.find(e => e.id === id);
            if (!exercise) return;
            
            currentExercise = exercise;
            codeEditor.textContent = exercise.code;
            
            // Update file name to show it's an exercise
            document.getElementById('currentFileName').textContent = `exercise-${id}.js`;
            
            // Reset console and debug info
            consoleOutput.innerHTML = '';
            debugInfoContent.textContent = `Loaded exercise: ${exercise.title}. Try to find and fix the bug!`;
            variablesPanel.innerHTML = '';
            callStackContent.innerHTML = '';
            aiSuggestions.classList.remove('active');
            
            // Add message to console
            addConsoleMessage(`Loaded exercise: ${exercise.title}`, "info");
            addConsoleMessage(`Difficulty: ${exercise.difficulty}`, "info");
            addConsoleMessage("Edit the code to fix the bug, then run it to test.", "info");
            
            // Highlight potential errors
            highlightPotentialErrors();
            
            showSuccessPopup(`Exercise "${exercise.title}" loaded. Try to find and fix the bug!`);
        }
        
        // Run the current code
        function runCode() {
            // Clear previous results
            consoleOutput.innerHTML = '';
            variablesPanel.innerHTML = '';
            callStackContent.innerHTML = '';
            aiSuggestions.classList.remove('active');
            
            // Get code from editor
            const code = codeEditor.textContent;
            
            try {
                // Create a safe execution environment
                const originalConsoleLog = console.log;
                const originalConsoleError = console.error;
                
                // Capture console output
                console.log = function(...args) {
                    addConsoleMessage(args.map(arg => 
                        typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
                    ).join(' '), "info");
                    originalConsoleLog.apply(console, args);
                };
                
                console.error = function(...args) {
                    addConsoleMessage(args.map(arg => 
                        typeof arg === 'object' ? JSON.stringify(arg) : String(arg)
                    ).join(' '), "error");
                    originalConsoleError.apply(console, args);
                };
                
                // Execute the code
                eval(code);
                
                // Restore original console
                console.log = originalConsoleLog;
                console.error = originalConsoleError;
                
                // Update debug info
                debugInfoContent.innerHTML = `
                    <p><i class="fas fa-check-circle" style="color: #22c55e;"></i> Code executed successfully!</p>
                    <p>Check the console output above for results.</p>
                    <p>If you see unexpected results or errors, try using the AI Help or Debugging features.</p>
                `;
                
                // Check if current exercise was solved
                if (currentExercise) {
                    checkExerciseSolution();
                }
                
            } catch (error) {
                // Handle runtime errors
                addConsoleMessage(`Error: ${error.message}`, "error");
                addConsoleMessage(`Stack: ${error.stack}`, "error");
                
                debugInfoContent.innerHTML = `
                    <p><i class="fas fa-exclamation-circle" style="color: #ef4444;"></i> Runtime Error Occurred</p>
                    <p><strong>${error.name}:</strong> ${error.message}</p>
                    <p>Line: ${error.lineNumber || 'Unknown'}</p>
                    <p>Use the AI Help button for suggestions on fixing this error.</p>
                `;
                
                showErrorPopup(`Runtime Error: ${error.message}`);
            }
        }
        
        // Start debugging session
        function startDebugging() {
            isDebugging = true;
            
            // Clear previous results
            consoleOutput.innerHTML = '';
            variablesPanel.innerHTML = '';
            callStackContent.innerHTML = '';
            
            // Get code from editor
            const code = codeEditor.textContent;
            
            // Simulate debugging by analyzing the code
            analyzeCodeForDebugging(code);
            
            // Update debug info
            debugInfoContent.innerHTML = `
                <p><i class="fas fa-search" style="color: #8b5cf6;"></i> Debugging Session Started</p>
                <p>Code analysis complete. Found ${breakpoints.length} potential issues.</p>
                <p>Check the variables panel and call stack for execution details.</p>
                <p>Use step-through debugging (coming soon) to trace execution line by line.</p>
            `;
            
            addConsoleMessage("Debugging session started. Analyzing code...", "info");
            addConsoleMessage(`Found ${breakpoints.length} potential issues to examine.`, "info");
            
            // Show AI suggestions
            generateAISuggestions();
        }
        
        // Analyze code for debugging
        function analyzeCodeForDebugging(code) {
            // Reset breakpoints
            breakpoints = [];
            
            // Parse code lines
            const lines = code.split('\n');
            
            // Look for potential issues in each line
            lines.forEach((line, index) => {
                const lineNum = index + 1;
                
                // Check for common issues
                if (line.includes('var ') && line.includes('for (')) {
                    breakpoints.push({
                        line: lineNum,
                        type: 'warning',
                        message: 'Using var in loop may cause scope issues. Consider using let.'
                    });
                }
                
                if (line.includes('getMonth()') && !line.includes('getMonth() + 1')) {
                    breakpoints.push({
                        line: lineNum,
                        type: 'error',
                        message: 'getMonth() returns 0-11. Add 1 for correct month display.'
                    });
                }
                
                if (line.includes('return price - (price * discountPercent)') && 
                    !line.includes('discountPercent / 100')) {
                    breakpoints.push({
                        line: lineNum,
                        type: 'error',
                        message: 'Discount percentage should be divided by 100 to convert to decimal.'
                    });
                }
                
                if (line.includes('let max = 0') && line.includes('findMax')) {
                    breakpoints.push({
                        line: lineNum,
                        type: 'warning',
                        message: 'Initializing max with 0 fails for negative numbers. Use first element or -Infinity.'
                    });
                }
                
                if (line.includes('if (!user.name || !user.email || !user.age)')) {
                    breakpoints.push({
                        line: lineNum,
                        type: 'warning',
                        message: 'Condition may not catch all invalid cases (empty strings, zero age).'
                    });
                }
                
                if (line.includes('subtotal * taxRate') && !line.includes('Math.round')) {
                    breakpoints.push({
                        line: lineNum,
                        type: 'warning',
                        message: 'Floating point arithmetic may cause precision issues with currency.'
                    });
                }
            });
            
            // Update variables panel with simulated variables
            updateVariablesPanel();
            
            // Update call stack with simulated call stack
            updateCallStack();
            
            // Highlight lines with issues in editor
            highlightPotentialErrors();
        }
        
        // Update variables panel
        function updateVariablesPanel() {
            variablesPanel.innerHTML = '';
            
            // Simulate some variables based on the code
            const simulatedVars = [
                { name: 'discountPercent', value: 20, type: 'number' },
                { name: 'price', value: 100, type: 'number' },
                { name: 'numbers', value: '[5, 8, 2, 10, 3]', type: 'array' },
                { name: 'max', value: 0, type: 'number' },
                { name: 'subtotal', value: 41.93, type: 'number' },
                { name: 'taxRate', value: 0.08, type: 'number' },
                { name: 'tax', value: 3.3544, type: 'number' },
                { name: 'total', value: 45.2844, type: 'number' },
                { name: 'user', value: '{name: "John", email: "john@test.com", age: 25}', type: 'object' },
                { name: 'date', value: '2023-05-15T00:00:00.000Z', type: 'Date' }
            ];
            
            simulatedVars.forEach(variable => {
                const varCard = document.createElement('div');
                varCard.className = 'variable-card';
                
                varCard.innerHTML = `
                    <div class="variable-name">${variable.name}</div>
                    <div class="variable-value">${variable.value}</div>
                    <div class="variable-type">${variable.type}</div>
                `;
                
                variablesPanel.appendChild(varCard);
            });
        }
        
        // Update call stack
        function updateCallStack() {
            callStackContent.innerHTML = '';
            
            // Simulate call stack
            const stackFrames = [
                { function: 'calculateDiscount', location: 'buggy.js:4' },
                { function: 'processOrder', location: 'buggy.js:15' },
                { function: 'validateUser', location: 'buggy.js:25' },
                { function: 'findMax', location: 'buggy.js:35' },
                { function: 'formatDate', location: 'buggy.js:45' },
                { function: 'global', location: 'buggy.js:55' }
            ];
            
            stackFrames.forEach(frame => {
                const frameElement = document.createElement('div');
                frameElement.className = 'stack-frame';
                
                frameElement.innerHTML = `
                    <div class="frame-function">${frame.function}()</div>
                    <div class="frame-location">${frame.location}</div>
                `;
                
                callStackContent.appendChild(frameElement);
            });
        }
        
        // Highlight potential errors in the editor
        function highlightPotentialErrors() {
            // This is a simplified version - in a real app, you'd use a proper code editor
            const code = codeEditor.textContent;
            const lines = code.split('\n');
            
            // Clear previous highlights
            codeEditor.innerHTML = '';
            
            // Rebuild with highlighting
            lines.forEach((line, index) => {
                const lineNum = index + 1;
                const lineElement = document.createElement('div');
                
                // Check if this line has a breakpoint
                const breakpoint = breakpoints.find(bp => bp.line === lineNum);
                
                if (breakpoint) {
                    if (breakpoint.type === 'error') {
                        lineElement.className = 'error-line';
                    } else if (breakpoint.type === 'warning') {
                        lineElement.className = 'warning-line';
                    }
                    
                    // Add tooltip
                    lineElement.title = breakpoint.message;
                }
                
                // Add line number
                const lineNumberSpan = document.createElement('span');
                lineNumberSpan.className = 'line-number';
                lineNumberSpan.textContent = lineNum;
                lineElement.appendChild(lineNumberSpan);
                
                // Add line content
                lineElement.appendChild(document.createTextNode(line));
                
                codeEditor.appendChild(lineElement);
            });
        }
        
        // Generate AI suggestions
        function generateAISuggestions() {
            suggestionsList.innerHTML = '';
            
            // Show loader
            const loader = document.createElement('div');
            loader.style.textAlign = 'center';
            loader.style.padding = '20px';
            loader.innerHTML = '<div class="loader"></div><p style="margin-top: 10px; color: #94a3b8;">Analyzing code with AI...</p>';
            suggestionsList.appendChild(loader);
            
            // Simulate AI processing delay
            setTimeout(() => {
                suggestionsList.innerHTML = '';
                
                // Generate suggestions based on breakpoints
                breakpoints.forEach((breakpoint, index) => {
                    const suggestion = document.createElement('div');
                    suggestion.className = 'ai-suggestion';
                    
                    let suggestionText = '';
                    let fixCode = '';
                    
                    switch(breakpoint.message) {
                        case 'Using var in loop may cause scope issues. Consider using let.':
                            suggestionText = 'Replace `var` with `let` in for-loop declarations to avoid scope issues.';
                            fixCode = 'for (let i = 0; i < items.length; i++) {';
                            break;
                        case 'getMonth() returns 0-11. Add 1 for correct month display.':
                            suggestionText = 'Add 1 to getMonth() result to display correct month (1-12 instead of 0-11).';
                            fixCode = 'return `${date.getMonth() + 1}/${date.getDate()}/${date.getFullYear()}`;';
                            break;
                        case 'Discount percentage should be divided by 100 to convert to decimal.':
                            suggestionText = 'Divide discountPercent by 100 to convert percentage to decimal before calculation.';
                            fixCode = 'return price - (price * (discountPercent / 100));';
                            break;
                        case 'Initializing max with 0 fails for negative numbers. Use first element or -Infinity.':
                            suggestionText = 'Initialize max with the first array element or -Infinity to handle negative numbers.';
                            fixCode = 'let max = numbers.length > 0 ? numbers[0] : -Infinity;';
                            break;
                        case 'Condition may not catch all invalid cases (empty strings, zero age).':
                            suggestionText = 'Add additional validation for empty strings and check age type.';
                            fixCode = 'if (!user.name || user.name.trim() === "" || !user.email || typeof user.age !== "number") {';
                            break;
                        case 'Floating point arithmetic may cause precision issues with currency.':
                            suggestionText = 'Use Math.round() to avoid floating point precision issues with currency calculations.';
                            fixCode = 'total = Math.round(total * 100) / 100;';
                            break;
                        default:
                            suggestionText = 'Review this code for potential logic errors or edge cases.';
                            fixCode = '// Review and test this code section thoroughly';
                    }
                    
                    suggestion.innerHTML = `
                        <div class="suggestion-header">
                            <div class="suggestion-title">Suggestion ${index + 1}</div>
                            <div class="confidence">${Math.floor(Math.random() * 30) + 70}% confidence</div>
                        </div>
                        <div class="suggestion-desc">${suggestionText}</div>
                        <div class="suggestion-code">${fixCode}</div>
                        <div class="suggestion-actions">
                            <button class="suggestion-btn apply" data-line="${breakpoint.line}" data-fix="${fixCode}">
                                <i class="fas fa-check"></i> Apply Fix
                            </button>
                            <button class="suggestion-btn explain" data-message="${breakpoint.message}">
                                <i class="fas fa-info-circle"></i> Explain
                            </button>
                        </div>
                    `;
                    
                    suggestionsList.appendChild(suggestion);
                });
                
                // Add event listeners to suggestion buttons
                document.querySelectorAll('.suggestion-btn.apply').forEach(btn => {
                    btn.addEventListener('click', applySuggestionFix);
                });
                
                document.querySelectorAll('.suggestion-btn.explain').forEach(btn => {
                    btn.addEventListener('click', explainSuggestion);
                });
                
                // Show the suggestions panel
                aiSuggestions.classList.add('active');
                
            }, 1500); // Simulate AI processing time
        }
        
        // Apply a suggested fix
        function applySuggestionFix(event) {
            const lineNum = parseInt(event.target.dataset.line);
            const fixCode = event.target.dataset.fix;
            
            // Get current code
            const code = codeEditor.textContent;
            const lines = code.split('\n');
            
            // Apply fix to the specified line (simplified)
            if (lineNum > 0 && lineNum <= lines.length) {
                // In a real app, you'd do proper code replacement
                // For this demo, we'll just show a message
                showSuccessPopup(`Fix suggestion applied to line ${lineNum}. Review the change in the editor.`);
                
                // Highlight the line as fixed
                const lineElements = codeEditor.querySelectorAll('div');
                if (lineElements[lineNum - 1]) {
                    lineElements[lineNum - 1].classList.remove('error-line', 'warning-line');
                    lineElements[lineNum - 1].classList.add('success-line');
                }
            }
        }
        
        // Explain a suggestion
        function explainSuggestion(event) {
            const message = event.target.dataset.message;
            
            debugInfoContent.innerHTML = `
                <p><i class="fas fa-robot" style="color: #ec4899;"></i> AI Explanation</p>
                <p><strong>Issue:</strong> ${message}</p>
                <p><strong>Explanation:</strong> This is a common coding issue that can lead to bugs. The AI has detected a pattern that often causes problems in similar code.</p>
                <p><strong>Why it matters:</strong> Fixing this issue will make your code more robust, maintainable, and less prone to edge case failures.</p>
                <p><strong>Best practice:</strong> Always consider edge cases and test with various inputs to ensure your code handles all scenarios correctly.</p>
            `;
        }
        
        // Check if current exercise is solved
        function checkExerciseSolution() {
            if (!currentExercise) return;
            
            // Simplified solution check - in a real app, you'd run tests
            const currentCode = codeEditor.textContent;
            const solutionKeywords = currentExercise.solution.split('\n').slice(0, 3).join(' ').toLowerCase();
            const currentKeywords = currentCode.toLowerCase();
            
            // Check if solution appears in code
            let isLikelySolved = false;
            
            // Check for key fixes based on exercise
            switch(currentExercise.id) {
                case 1: // Discount calculation
                    isLikelySolved = currentCode.includes('discountPercent / 100') || 
                                     currentCode.includes('discountPercent * 0.01') ||
                                     currentCode.includes('discountPercent/100');
                    break;
                case 2: // Find max
                    isLikelySolved = (currentCode.includes('max = numbers[0]') || 
                                     currentCode.includes('max = numbers.length > 0')) &&
                                     !currentCode.includes('let max = 0;');
                    break;
                case 3: // Date formatting
                    isLikelySolved = currentCode.includes('getMonth() + 1');
                    break;
                case 4: // User validation
                    isLikelySolved = currentCode.includes('typeof user.age') || 
                                     currentCode.includes('user.age === undefined');
                    break;
                case 5: // Order processing
                    isLikelySolved = currentCode.includes('Math.round') && 
                                     currentCode.includes('let i = 0');
                    break;
            }
            
            if (isLikelySolved) {
                showSuccessPopup(`Great job! You've likely fixed the "${currentExercise.title}" exercise!`);
                addConsoleMessage(` Exercise "${currentExercise.title}" appears to be solved!`, "success");
                
                // Offer to show solution
                setTimeout(() => {
                    if (confirm('Would you like to see the suggested solution?')) {
                        debugInfoContent.innerHTML = `
                            <p><i class="fas fa-graduation-cap" style="color: #8b5cf6;"></i> Exercise Solution</p>
                            <p><strong>Problem:</strong> ${currentExercise.description}</p>
                            <p><strong>Solution:</strong></p>
                            <pre style="background: #0f172a; padding: 15px; border-radius: 8px; margin-top: 10px; overflow: auto;">${currentExercise.solution}</pre>
                            <p style="margin-top: 15px;"><strong>Explanation:</strong> ${currentExercise.hints.join(' ')}</p>
                        `;
                    }
                }, 1000);
            }
        }
        
        // Auto-fix code
        function autoFixCode() {
            // Simulate AI fixing the code
            addConsoleMessage("AI is analyzing and fixing code...", "info");
            
            // Show loader
            const originalText = fixBtn.innerHTML;
            fixBtn.innerHTML = '<div class="loader" style="margin-right: 10px;"></div> Fixing...';
            fixBtn.disabled = true;
            
            setTimeout(() => {
                // Reset button
                fixBtn.innerHTML = originalText;
                fixBtn.disabled = false;
                
                // Apply fixes based on breakpoints
                let fixCount = 0;
                
                breakpoints.forEach(breakpoint => {
                    if (breakpoint.type === 'error') {
                        // Count as fixed
                        fixCount++;
                        
                        // Highlight as fixed in editor
                        const lineElements = codeEditor.querySelectorAll('div');
                        if (lineElements[breakpoint.line - 1]) {
                            lineElements[breakpoint.line - 1].classList.remove('error-line');
                            lineElements[breakpoint.line - 1].classList.add('success-line');
                        }
                    }
                });
                
                if (fixCount > 0) {
                    showSuccessPopup(`AI fixed ${fixCount} issues automatically. Review the changes in the editor.`);
                    addConsoleMessage(` AI automatically fixed ${fixCount} issues.`, "success");
                } else {
                    showSuccessPopup("No critical issues found to auto-fix. The code looks good!");
                    addConsoleMessage("No critical issues found to auto-fix.", "info");
                }
            }, 2000);
        }
        
        // Reset debugging state
        function resetDebuggingState() {
            isDebugging = false;
            breakpoints = [];
            currentLine = 0;
            variables = {};
            callStack = [];
            
            // Clear UI elements
            variablesPanel.innerHTML = '';
            callStackContent.innerHTML = '';
            aiSuggestions.classList.remove('active');
            
            // Reset debug info
            debugInfoContent.textContent = 'Click "Run Code" or "Start Debugging" to see debug information here.';
        }
        
        // Add message to console
        function addConsoleMessage(message, type = "info") {
            const consoleLine = document.createElement('div');
            consoleLine.className = `console-line console-${type}`;
            
            // Add timestamp
            const now = new Date();
            const timestamp = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit', second:'2-digit'});
            
            // Create icon based on type
            let icon = 'info-circle';
            if (type === 'error') icon = 'exclamation-circle';
            if (type === 'warning') icon = 'exclamation-triangle';
            if (type === 'success') icon = 'check-circle';
            
            consoleLine.innerHTML = `<i class="fas fa-${icon}"></i> [${timestamp}] ${message}`;
            consoleOutput.appendChild(consoleLine);
            
            // Auto-scroll to bottom
            consoleOutput.scrollTop = consoleOutput.scrollHeight;
        }
        
        // Show error popup
        function showErrorPopup(message) {
            errorMessage.textContent = message;
            errorPopup.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                errorPopup.style.display = 'none';
            }, 5000);
        }
        
        // Show success popup
        function showSuccessPopup(message) {
            successMessage.textContent = message;
            successPopup.style.display = 'block';
            
            // Auto-hide after 3 seconds
            setTimeout(() => {
                successPopup.style.display = 'none';
            }, 3000);
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Button event listeners
            runBtn.addEventListener('click', runCode);
            debugBtn.addEventListener('click', startDebugging);
            aiHelpBtn.addEventListener('click', generateAISuggestions);
            fixBtn.addEventListener('click', autoFixCode);
            resetBtn.addEventListener('click', () => {
                loadFile(currentFile);
                showSuccessPopup("Editor reset to original code.");
            });
            
            formatBtn.addEventListener('click', () => {
                // Simplified formatting - in a real app, use a proper formatter
                const code = codeEditor.textContent;
                // Basic indentation fix
                const formatted = code.replace(/\t/g, '  ').replace(/^\s+/gm, '');
                codeEditor.textContent = formatted;
                showSuccessPopup("Code formatted.");
            });
            
            saveBtn.addEventListener('click', () => {
                // Save current code to the file in memory
                codeFiles[currentFile] = codeEditor.textContent;
                showSuccessPopup(`Code saved to ${currentFile}`);
            });
            
            clearConsoleBtn.addEventListener('click', () => {
                consoleOutput.innerHTML = '';
                addConsoleMessage("Console cleared.", "info");
            });
            
            // Tab switching
            codeTabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    loadFile(tab.dataset.file);
                });
            });
            
            // Popup close buttons
            closeErrorBtn.addEventListener('click', () => {
                errorPopup.style.display = 'none';
            });
            
            closeSuccessBtn.addEventListener('click', () => {
                successPopup.style.display = 'none';
            });
            
            // Click outside popups to close
            window.addEventListener('click', (event) => {
                if (event.target === errorPopup) {
                    errorPopup.style.display = 'none';
                }
                if (event.target === successPopup) {
                    successPopup.style.display = 'none';
                }
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                // Ctrl/Cmd + S to save
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    saveBtn.click();
                }
                
                // Ctrl/Cmd + Enter to run
                if ((e.ctrlKey || e.metaKey) && e.key === 'Enter') {
                    e.preventDefault();
                    runBtn.click();
                }
                
                // F5 to debug
                if (e.key === 'F5') {
                    e.preventDefault();
                    debugBtn.click();
                }
                
                // F1 for AI help
                if (e.key === 'F1') {
                    e.preventDefault();
                    aiHelpBtn.click();
                }
            });
            
            // Add instructions to tagline
            document.addEventListener('DOMContentLoaded', () => {
                const tagline = document.querySelector('.tagline');
                tagline.innerHTML += '<br><small>Shortcuts: Ctrl+S to save, Ctrl+Enter to run, F5 to debug, F1 for AI help</small>';
            });
        }
        
        // Initialize the application
        init();
    </script>
</body>
</html>