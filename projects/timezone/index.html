<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Time Zone Converter</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/flag-icon-css/3.5.0/css/flag-icon.min.css">
  <style>
    /* Base Styles */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Segoe UI', system-ui, -apple-system, sans-serif;
    }

    :root {
      --primary: #2563eb;
      --primary-dark: #1d4ed8;
      --secondary: #475569;
      --accent: #0ea5e9;
      --success: #10b981;
      --warning: #f59e0b;
      --danger: #ef4444;
      --light: #f8fafc;
      --dark: #1e293b;
      --gray: #94a3b8;
      --border: #e2e8f0;
      --card-bg: #ffffff;
      --shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
    }

    body {
      background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%);
      color: var(--dark);
      line-height: 1.6;
      min-height: 100vh;
      padding: 20px;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
    }

    /* Header */
    header {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 25px 30px;
      margin-bottom: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 20px;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 15px;
    }

    .logo-icon {
      width: 50px;
      height: 50px;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 1.5rem;
    }

    .logo-text h1 {
      font-size: 2rem;
      font-weight: 800;
      background: linear-gradient(135deg, var(--primary), var(--accent));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 5px;
    }

    .logo-text p {
      color: var(--secondary);
      font-size: 0.95rem;
    }

    .current-time {
      background: var(--light);
      padding: 15px 25px;
      border-radius: 12px;
      border: 1px solid var(--border);
      text-align: center;
      min-width: 200px;
    }

    .current-time .label {
      font-size: 0.85rem;
      color: var(--secondary);
      margin-bottom: 5px;
    }

    .current-time .time {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      font-family: 'Courier New', monospace;
    }

    .current-time .date {
      font-size: 0.9rem;
      color: var(--gray);
      margin-top: 5px;
    }

    /* Main Content */
    .main-content {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 25px;
      margin-bottom: 30px;
    }

    @media (max-width: 1024px) {
      .main-content {
        grid-template-columns: 1fr;
      }
    }

    /* Cards */
    .card {
      background: var(--card-bg);
      border-radius: 16px;
      padding: 25px;
      box-shadow: var(--shadow);
      border: 1px solid var(--border);
      height: fit-content;
    }

    .card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      padding-bottom: 15px;
      border-bottom: 2px solid var(--border);
    }

    .card-title {
      font-size: 1.3rem;
      font-weight: 700;
      color: var(--dark);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .card-title i {
      color: var(--primary);
    }

    /* Converter Card */
    .converter-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .time-input-section {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 20px;
    }

    @media (max-width: 768px) {
      .time-input-section {
        grid-template-columns: 1fr;
      }
    }

    .time-input-group {
      background: var(--light);
      padding: 20px;
      border-radius: 12px;
      border: 1px solid var(--border);
    }

    .time-input-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .time-label {
      font-weight: 600;
      color: var(--secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .time-display {
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--dark);
      font-family: 'Courier New', monospace;
      margin-bottom: 15px;
      padding: 10px;
      background: white;
      border-radius: 8px;
      border: 1px solid var(--border);
      text-align: center;
    }

    .date-display {
      font-size: 0.9rem;
      color: var(--gray);
      text-align: center;
      margin-bottom: 15px;
    }

    .timezone-selector {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .timezone-search {
      position: relative;
    }

    .timezone-search i {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--gray);
    }

    .timezone-search input {
      width: 100%;
      padding: 12px 12px 12px 40px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 0.95rem;
      transition: all 0.2s;
    }

    .timezone-search input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .timezone-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid var(--border);
      border-radius: 8px;
      background: white;
    }

    .timezone-option {
      padding: 12px 15px;
      border-bottom: 1px solid var(--border);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 10px;
      transition: all 0.2s;
    }

    .timezone-option:hover {
      background: var(--light);
    }

    .timezone-option.active {
      background: rgba(37, 99, 235, 0.1);
      border-left: 4px solid var(--primary);
    }

    .timezone-flag {
      width: 24px;
      height: 24px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1rem;
    }

    .timezone-info {
      flex: 1;
    }

    .timezone-name {
      font-weight: 600;
      color: var(--dark);
      font-size: 0.95rem;
    }

    .timezone-offset {
      font-size: 0.8rem;
      color: var(--gray);
    }

    .swap-button {
      align-self: center;
      margin: 10px 0;
    }

    /* World Clocks Card */
    .clocks-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
      gap: 15px;
      margin-top: 20px;
    }

    .clock-card {
      background: var(--light);
      border-radius: 12px;
      padding: 20px;
      border: 1px solid var(--border);
      text-align: center;
      transition: all 0.2s;
      cursor: pointer;
    }

    .clock-card:hover {
      transform: translateY(-5px);
      box-shadow: var(--shadow);
    }

    .clock-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .clock-flag {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      overflow: hidden;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.2rem;
    }

    .clock-city {
      font-weight: 700;
      color: var(--dark);
      margin-bottom: 5px;
    }

    .clock-time {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--primary);
      font-family: 'Courier New', monospace;
      margin-bottom: 5px;
    }

    .clock-date {
      font-size: 0.85rem;
      color: var(--gray);
      margin-bottom: 10px;
    }

    .clock-offset {
      font-size: 0.8rem;
      color: var(--secondary);
      padding: 4px 8px;
      background: white;
      border-radius: 20px;
      border: 1px solid var(--border);
      display: inline-block;
    }

    /* Meeting Planner */
    .meeting-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .form-group {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .form-group label {
      font-weight: 600;
      color: var(--secondary);
      display: flex;
      align-items: center;
      gap: 8px;
    }

    .form-group label i {
      color: var(--primary);
    }

    input, select {
      padding: 12px 15px;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
      transition: all 0.2s;
    }

    input:focus, select:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .participants-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-top: 10px;
    }

    .participant-card {
      background: var(--light);
      padding: 15px;
      border-radius: 10px;
      border: 1px solid var(--border);
      text-align: center;
    }

    .participant-time {
      font-weight: 700;
      color: var(--primary);
      font-family: 'Courier New', monospace;
      margin: 10px 0;
    }

    .participant-timezone {
      font-size: 0.85rem;
      color: var(--gray);
    }

    /* Timezone Map Card */
    .map-container {
      height: 300px;
      background: var(--light);
      border-radius: 12px;
      overflow: hidden;
      margin-top: 20px;
      position: relative;
    }

    .world-map {
      width: 100%;
      height: 100%;
      background: #e0f2fe;
      position: relative;
    }

    .timezone-marker {
      position: absolute;
      width: 12px;
      height: 12px;
      background: var(--primary);
      border-radius: 50%;
      border: 2px solid white;
      box-shadow: 0 2px 4px rgba(0,0,0,0.2);
      cursor: pointer;
      transition: all 0.2s;
    }

    .timezone-marker:hover {
      transform: scale(1.5);
      background: var(--danger);
    }

    .timezone-marker.active {
      background: var(--danger);
      transform: scale(1.3);
    }

    .map-legend {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-top: 15px;
      flex-wrap: wrap;
    }

    .legend-item {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.85rem;
      color: var(--secondary);
    }

    .legend-color {
      width: 12px;
      height: 12px;
      border-radius: 50%;
    }

    /* Buttons */
    .btn {
      padding: 12px 24px;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
      transition: all 0.2s ease;
      font-size: 0.95rem;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: var(--primary-dark);
      transform: translateY(-2px);
      box-shadow: var(--shadow);
    }

    .btn-secondary {
      background: var(--light);
      color: var(--primary);
      border: 1px solid var(--primary);
    }

    .btn-secondary:hover {
      background: rgba(37, 99, 235, 0.05);
    }

    .btn-icon {
      width: 40px;
      height: 40px;
      padding: 0;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      color: var(--secondary);
      font-size: 0.9rem;
      border-top: 1px solid var(--border);
      margin-top: 40px;
    }

    /* Empty States */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--gray);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 15px;
      opacity: 0.5;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        align-items: flex-start;
      }
      
      .current-time {
        width: 100%;
      }
      
      .clocks-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }
    }

    @media (max-width: 480px) {
      .card {
        padding: 20px 15px;
      }
      
      .clock-card {
        padding: 15px;
      }
    }

    /* Animation */
    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .fade-in {
      animation: fadeIn 0.3s ease;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <div class="header-content">
        <div class="logo">
          <div class="logo-icon">
            <i class="fas fa-globe-americas"></i>
          </div>
          <div class="logo-text">
            <h1>Time Zone Converter</h1>
            <p>Convert times across time zones worldwide</p>
          </div>
        </div>
        <div class="current-time">
          <div class="label">Your Local Time</div>
          <div class="time" id="localTime">00:00:00</div>
          <div class="date" id="localDate">Monday, January 1, 2026</div>
        </div>
      </div>
    </header>

    <div class="main-content">
      <!-- Converter Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-exchange-alt"></i> Time Zone Converter
          </h2>
          <button class="btn btn-secondary" id="swapTimezones">
            <i class="fas fa-sync-alt"></i> Swap
          </button>
        </div>
        
        <div class="converter-form">
          <div class="time-input-section">
            <!-- From Timezone -->
            <div class="time-input-group">
              <div class="time-input-header">
                <div class="time-label">
                  <i class="fas fa-map-marker-alt"></i> From
                </div>
                <button class="btn btn-icon btn-secondary" onclick="useMyTimezone('from')">
                  <i class="fas fa-crosshairs"></i>
                </button>
              </div>
              <div class="time-display" id="fromTimeDisplay">12:00:00 PM</div>
              <div class="date-display" id="fromDateDisplay">Monday, January 1, 2026</div>
              
              <div class="timezone-selector">
                <div class="timezone-search">
                  <i class="fas fa-search"></i>
                  <input type="text" id="fromSearch" placeholder="Search timezone...">
                </div>
                <div class="timezone-list" id="fromTimezoneList">
                  <!-- Timezone options will be populated here -->
                </div>
              </div>
            </div>
            
            <!-- To Timezone -->
            <div class="time-input-group">
              <div class="time-input-header">
                <div class="time-label">
                  <i class="fas fa-flag"></i> To
                </div>
                <button class="btn btn-icon btn-secondary" onclick="useMyTimezone('to')">
                  <i class="fas fa-crosshairs"></i>
                </button>
              </div>
              <div class="time-display" id="toTimeDisplay">12:00:00 PM</div>
              <div class="date-display" id="toDateDisplay">Monday, January 1, 2026</div>
              
              <div class="timezone-selector">
                <div class="timezone-search">
                  <i class="fas fa-search"></i>
                  <input type="text" id="toSearch" placeholder="Search timezone...">
                </div>
                <div class="timezone-list" id="toTimezoneList">
                  <!-- Timezone options will be populated here -->
                </div>
              </div>
            </div>
          </div>
          
          <div class="swap-button">
            <button class="btn btn-icon btn-primary" id="swapButton">
              <i class="fas fa-arrow-down-arrow-up"></i>
            </button>
          </div>
          
          <div class="form-group">
            <label for="conversionTime"><i class="fas fa-clock"></i> Set Specific Time</label>
            <input type="datetime-local" id="conversionTime">
          </div>
          
          <button class="btn btn-primary" id="convertNow">
            <i class="fas fa-calculator"></i> Convert Now
          </button>
        </div>
      </div>

      <!-- World Clocks Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-globe"></i> World Clocks
          </h2>
          <button class="btn btn-secondary" id="addClock">
            <i class="fas fa-plus"></i> Add
          </button>
        </div>
        
        <div class="clocks-grid" id="worldClocksGrid">
          <!-- World clocks will be added here -->
        </div>
        
        <div class="empty-state" id="emptyClocks" style="display: none;">
          <i class="fas fa-globe-americas"></i>
          <h3>No World Clocks</h3>
          <p>Add your first world clock to track time in different cities</p>
          <button class="btn btn-primary" id="addFirstClock" style="margin-top: 15px;">
            <i class="fas fa-plus"></i> Add World Clock
          </button>
        </div>
      </div>

      <!-- Meeting Planner Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-calendar-alt"></i> Meeting Planner
          </h2>
          <button class="btn btn-secondary" id="clearMeeting">
            <i class="fas fa-eraser"></i> Clear
          </button>
        </div>
        
        <div class="meeting-form">
          <div class="form-group">
            <label for="meetingTime"><i class="fas fa-clock"></i> Meeting Time</label>
            <input type="datetime-local" id="meetingTime">
          </div>
          
          <div class="form-group">
            <label for="meetingDuration"><i class="fas fa-hourglass-half"></i> Duration</label>
            <select id="meetingDuration">
              <option value="30">30 minutes</option>
              <option value="60" selected>1 hour</option>
              <option value="90">1.5 hours</option>
              <option value="120">2 hours</option>
              <option value="180">3 hours</option>
            </select>
          </div>
          
          <div class="form-group">
            <label><i class="fas fa-users"></i> Participants</label>
            <div class="participants-grid" id="meetingParticipants">
              <!-- Participants will be added here -->
            </div>
            <button class="btn btn-secondary" id="addParticipant" style="margin-top: 10px;">
              <i class="fas fa-user-plus"></i> Add Participant
            </button>
          </div>
          
          <button class="btn btn-primary" id="calculateMeeting">
            <i class="fas fa-calculator"></i> Calculate Times
          </button>
        </div>
      </div>

      <!-- Timezone Map Card -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">
            <i class="fas fa-map"></i> Timezone Map
          </h2>
          <button class="btn btn-secondary" id="refreshMap">
            <i class="fas fa-redo"></i> Refresh
          </button>
        </div>
        
        <div class="map-container">
          <div class="world-map" id="worldMap">
            <!-- Timezone markers will be added here -->
          </div>
        </div>
        
        <div class="map-legend">
          <div class="legend-item">
            <div class="legend-color" style="background-color: #2563eb;"></div>
            <span>Selected Timezone</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #10b981;"></div>
            <span>Common Timezones</span>
          </div>
          <div class="legend-item">
            <div class="legend-color" style="background-color: #f59e0b;"></div>
            <span>Other Timezones</span>
          </div>
        </div>
      </div>
    </div>

    <footer>
      <p>Time Zone Converter &copy; 2026 | Made with <i class="fas fa-heart" style="color: #ef4444;"></i> for global teams</p>
      <p style="margin-top: 5px; font-size: 0.8rem; color: #94a3b8;">All times are calculated in real-time based on your browser's local time</p>
    </footer>
  </div>

  <script>
    // Timezone data with cities and coordinates
    const timezones = [
      { id: 'utc', name: 'UTC', offset: 0, cities: ['UTC'], flag: 'ðŸŒ', coords: { x: 50, y: 50 } },
      { id: 'new_york', name: 'America/New_York', offset: -5, cities: ['New York', 'Toronto', 'Miami'], flag: 'ðŸ‡ºðŸ‡¸', coords: { x: 25, y: 45 } },
      { id: 'chicago', name: 'America/Chicago', offset: -6, cities: ['Chicago', 'Dallas', 'Mexico City'], flag: 'ðŸ‡ºðŸ‡¸', coords: { x: 22, y: 48 } },
      { id: 'denver', name: 'America/Denver', offset: -7, cities: ['Denver', 'Phoenix', 'Calgary'], flag: 'ðŸ‡ºðŸ‡¸', coords: { x: 20, y: 50 } },
      { id: 'los_angeles', name: 'America/Los_Angeles', offset: -8, cities: ['Los Angeles', 'San Francisco', 'Vancouver'], flag: 'ðŸ‡ºðŸ‡¸', coords: { x: 18, y: 52 } },
      { id: 'london', name: 'Europe/London', offset: 0, cities: ['London', 'Dublin', 'Lisbon'], flag: 'ðŸ‡¬ðŸ‡§', coords: { x: 48, y: 42 } },
      { id: 'paris', name: 'Europe/Paris', offset: 1, cities: ['Paris', 'Berlin', 'Rome'], flag: 'ðŸ‡«ðŸ‡·', coords: { x: 50, y: 43 } },
      { id: 'moscow', name: 'Europe/Moscow', offset: 3, cities: ['Moscow', 'Istanbul', 'Dubai'], flag: 'ðŸ‡·ðŸ‡º', coords: { x: 58, y: 43 } },
      { id: 'dubai', name: 'Asia/Dubai', offset: 4, cities: ['Dubai', 'Muscat', 'Baku'], flag: 'ðŸ‡¦ðŸ‡ª', coords: { x: 60, y: 48 } },
      { id: 'india', name: 'Asia/Kolkata', offset: 5.5, cities: ['Mumbai', 'Delhi', 'Bangalore'], flag: 'ðŸ‡®ðŸ‡³', coords: { x: 65, y: 52 } },
      { id: 'singapore', name: 'Asia/Singapore', offset: 8, cities: ['Singapore', 'Beijing', 'Hong Kong'], flag: 'ðŸ‡¸ðŸ‡¬', coords: { x: 70, y: 55 } },
      { id: 'tokyo', name: 'Asia/Tokyo', offset: 9, cities: ['Tokyo', 'Seoul', 'Osaka'], flag: 'ðŸ‡¯ðŸ‡µ', coords: { x: 75, y: 48 } },
      { id: 'sydney', name: 'Australia/Sydney', offset: 10, cities: ['Sydney', 'Melbourne', 'Brisbane'], flag: 'ðŸ‡¦ðŸ‡º', coords: { x: 80, y: 70 } },
      { id: 'auckland', name: 'Pacific/Auckland', offset: 12, cities: ['Auckland', 'Wellington'], flag: 'ðŸ‡³ðŸ‡¿', coords: { x: 85, y: 72 } },
      { id: 'hawaii', name: 'Pacific/Honolulu', offset: -10, cities: ['Honolulu'], flag: 'ðŸ‡ºðŸ‡¸', coords: { x: 15, y: 55 } },
      { id: 'sao_paulo', name: 'America/Sao_Paulo', offset: -3, cities: ['SÃ£o Paulo', 'Rio de Janeiro'], flag: 'ðŸ‡§ðŸ‡·', coords: { x: 32, y: 65 } },
      { id: 'cairo', name: 'Africa/Cairo', offset: 2, cities: ['Cairo', 'Johannesburg', 'Nairobi'], flag: 'ðŸ‡ªðŸ‡¬', coords: { x: 55, y: 52 } }
    ];

    // App state
    let appState = {
      fromTimezone: 'new_york',
      toTimezone: 'london',
      worldClocks: ['new_york', 'london', 'tokyo', 'sydney'],
      meetingParticipants: ['new_york', 'london', 'tokyo'],
      conversionTime: null,
      meetingTime: null
    };

    // Initialize the app
    function initApp() {
      // Load saved state from localStorage
      const savedState = localStorage.getItem('timezoneConverterState');
      if (savedState) {
        try {
          const parsed = JSON.parse(savedState);
          appState = { ...appState, ...parsed };
        } catch (e) {
          console.log('Could not load saved state');
        }
      }
      
      // Set current local time
      updateLocalTime();
      setInterval(updateLocalTime, 1000);
      
      // Initialize UI
      initConverter();
      initWorldClocks();
      initMeetingPlanner();
      initTimezoneMap();
      
      // Set up event listeners
      setupEventListeners();
      
      // Initial conversion
      performConversion();
    }

    // Update local time display
    function updateLocalTime() {
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-US', { 
        hour12: true, 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
      const dateStr = now.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      
      document.getElementById('localTime').textContent = timeStr;
      document.getElementById('localDate').textContent = dateStr;
    }

    // Initialize converter
    function initConverter() {
      // Populate timezone lists
      populateTimezoneList('fromTimezoneList', 'from', appState.fromTimezone);
      populateTimezoneList('toTimezoneList', 'to', appState.toTimezone);
      
      // Set conversion time to now if not set
      if (!appState.conversionTime) {
        const now = new Date();
        const localDateTime = new Date(now.getTime() - now.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
        document.getElementById('conversionTime').value = localDateTime;
        appState.conversionTime = now;
      } else {
        const date = new Date(appState.conversionTime);
        const localDateTime = new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
        document.getElementById('conversionTime').value = localDateTime;
      }
      
      // Set up search functionality
      document.getElementById('fromSearch').addEventListener('input', (e) => {
        filterTimezones('fromTimezoneList', 'from', e.target.value);
      });
      
      document.getElementById('toSearch').addEventListener('input', (e) => {
        filterTimezones('toTimezoneList', 'to', e.target.value);
      });
    }

    // Populate timezone list
    function populateTimezoneList(elementId, type, selectedId) {
      const container = document.getElementById(elementId);
      container.innerHTML = '';
      
      timezones.forEach(tz => {
        const option = document.createElement('div');
        option.className = `timezone-option ${tz.id === selectedId ? 'active' : ''}`;
        option.dataset.id = tz.id;
        option.dataset.type = type;
        
        const offsetStr = formatOffset(tz.offset);
        
        option.innerHTML = `
          <div class="timezone-flag">${tz.flag}</div>
          <div class="timezone-info">
            <div class="timezone-name">${tz.cities[0]}</div>
            <div class="timezone-offset">${tz.name} (UTC${offsetStr})</div>
          </div>
        `;
        
        option.addEventListener('click', () => selectTimezone(tz.id, type));
        container.appendChild(option);
      });
    }

    // Filter timezones based on search
    function filterTimezones(elementId, type, query) {
      const container = document.getElementById(elementId);
      const options = container.querySelectorAll('.timezone-option');
      const searchTerm = query.toLowerCase();
      
      options.forEach(option => {
        const text = option.textContent.toLowerCase();
        const shouldShow = text.includes(searchTerm);
        option.style.display = shouldShow ? 'flex' : 'none';
      });
    }

    // Select a timezone
    function selectTimezone(timezoneId, type) {
      if (type === 'from') {
        appState.fromTimezone = timezoneId;
        document.querySelectorAll('#fromTimezoneList .timezone-option').forEach(opt => {
          opt.classList.toggle('active', opt.dataset.id === timezoneId);
        });
      } else {
        appState.toTimezone = timezoneId;
        document.querySelectorAll('#toTimezoneList .timezone-option').forEach(opt => {
          opt.classList.toggle('active', opt.dataset.id === timezoneId);
        });
      }
      
      saveState();
      performConversion();
    }

    // Use my timezone
    function useMyTimezone(type) {
      // Try to detect user's timezone
      const userTimezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
      let matchedTz = timezones.find(tz => tz.name === userTimezone);
      
      if (!matchedTz) {
        // Try to find by offset
        const userOffset = -new Date().getTimezoneOffset() / 60;
        matchedTz = timezones.find(tz => Math.abs(tz.offset - userOffset) < 0.5);
      }
      
      if (matchedTz) {
        selectTimezone(matchedTz.id, type);
        showMessage(`Set to your timezone: ${matchedTz.cities[0]}`, 'success');
      } else {
        showMessage('Could not detect your timezone', 'warning');
      }
    }

    // Format offset for display
    function formatOffset(offset) {
      if (offset === 0) return '';
      const sign = offset > 0 ? '+' : '';
      const hours = Math.floor(Math.abs(offset));
      const minutes = Math.abs(offset) % 1 * 60;
      
      if (minutes === 0) {
        return `${sign}${hours}`;
      } else {
        return `${sign}${hours}:${minutes.toString().padStart(2, '0')}`;
      }
    }

    // Perform time conversion
    function performConversion() {
      const fromTz = timezones.find(tz => tz.id === appState.fromTimezone);
      const toTz = timezones.find(tz => tz.id === appState.toTimezone);
      
      if (!fromTz || !toTz) return;
      
      // Get the time to convert
      let dateTimeInput = document.getElementById('conversionTime').value;
      let date;
      
      if (dateTimeInput) {
        date = new Date(dateTimeInput);
      } else {
        date = new Date();
        const localDateTime = new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
        document.getElementById('conversionTime').value = localDateTime;
      }
      
      // Store the conversion time
      appState.conversionTime = date;
      
      // Calculate the time in the "from" timezone
      const fromDate = new Date(date.getTime() + (fromTz.offset * 60 - date.getTimezoneOffset() / 60) * 60000);
      
      // Calculate the time in the "to" timezone
      const toDate = new Date(fromDate.getTime() + (toTz.offset - fromTz.offset) * 60 * 60000);
      
      // Update displays
      updateTimeDisplay('fromTimeDisplay', 'fromDateDisplay', fromDate);
      updateTimeDisplay('toTimeDisplay', 'toDateDisplay', toDate);
      
      // Update timezone map
      updateTimezoneMap();
      
      saveState();
    }

    // Update time display
    function updateTimeDisplay(timeElementId, dateElementId, date) {
      const timeStr = date.toLocaleTimeString('en-US', { 
        hour12: true, 
        hour: '2-digit', 
        minute: '2-digit',
        second: '2-digit'
      });
      
      const dateStr = date.toLocaleDateString('en-US', { 
        weekday: 'long', 
        year: 'numeric', 
        month: 'long', 
        day: 'numeric' 
      });
      
      document.getElementById(timeElementId).textContent = timeStr;
      document.getElementById(dateElementId).textContent = dateStr;
    }

    // Initialize world clocks
    function initWorldClocks() {
      updateWorldClocks();
      setInterval(updateWorldClocks, 1000);
      
      // Show/hide empty state
      const emptyClocks = document.getElementById('emptyClocks');
      const clocksGrid = document.getElementById('worldClocksGrid');
      
      if (appState.worldClocks.length === 0) {
        emptyClocks.style.display = 'block';
        clocksGrid.style.display = 'none';
      } else {
        emptyClocks.style.display = 'none';
        clocksGrid.style.display = 'grid';
      }
    }

    // Update world clocks
    function updateWorldClocks() {
      const container = document.getElementById('worldClocksGrid');
      
      if (appState.worldClocks.length === 0) {
        container.innerHTML = '';
        return;
      }
      
      const now = new Date();
      container.innerHTML = appState.worldClocks.map(tzId => {
        const tz = timezones.find(t => t.id === tzId);
        if (!tz) return '';
        
        // Calculate time in this timezone
        const tzDate = new Date(now.getTime() + (tz.offset * 60 - now.getTimezoneOffset() / 60) * 60000);
        
        const timeStr = tzDate.toLocaleTimeString('en-US', { 
          hour12: true, 
          hour: '2-digit', 
          minute: '2-digit',
          second: '2-digit'
        });
        
        const dateStr = tzDate.toLocaleDateString('en-US', { 
          month: 'short', 
          day: 'numeric',
          year: tzDate.getFullYear() !== new Date().getFullYear() ? 'numeric' : undefined
        }).replace(',', '');
        
        const offsetStr = formatOffset(tz.offset);
        
        return `
          <div class="clock-card" data-id="${tz.id}">
            <div class="clock-header">
              <div class="clock-flag">${tz.flag}</div>
              <button class="btn btn-icon btn-secondary" style="padding: 4px; font-size: 0.8rem;" onclick="removeWorldClock('${tz.id}')">
                <i class="fas fa-times"></i>
              </button>
            </div>
            <div class="clock-city">${tz.cities[0]}</div>
            <div class="clock-time">${timeStr}</div>
            <div class="clock-date">${dateStr}</div>
            <div class="clock-offset">UTC${offsetStr}</div>
          </div>
        `;
      }).join('');
    }

    // Add a world clock
    function addWorldClock() {
      // Create a modal or dropdown to select timezone
      const availableTimezones = timezones.filter(tz => 
        !appState.worldClocks.includes(tz.id)
      );
      
      if (availableTimezones.length === 0) {
        showMessage('All timezones already added', 'warning');
        return;
      }
      
      // Simple prompt for demo purposes
      const tzList = availableTimezones.map((tz, i) => 
        `${i + 1}. ${tz.cities[0]} (UTC${formatOffset(tz.offset)})`
      ).join('\n');
      
      const selection = prompt(`Select a timezone to add:\n\n${tzList}\n\nEnter number (1-${availableTimezones.length}):`);
      const index = parseInt(selection) - 1;
      
      if (index >= 0 && index < availableTimezones.length) {
        const selectedTz = availableTimezones[index];
        appState.worldClocks.push(selectedTz.id);
        saveState();
        updateWorldClocks();
        
        // Hide empty state if shown
        const emptyClocks = document.getElementById('emptyClocks');
        const clocksGrid = document.getElementById('worldClocksGrid');
        emptyClocks.style.display = 'none';
        clocksGrid.style.display = 'grid';
        
        showMessage(`Added ${selectedTz.cities[0]} to world clocks`, 'success');
      }
    }

    // Remove a world clock
    function removeWorldClock(tzId) {
      appState.worldClocks = appState.worldClocks.filter(id => id !== tzId);
      saveState();
      updateWorldClocks();
      
      // Show empty state if no clocks left
      if (appState.worldClocks.length === 0) {
        const emptyClocks = document.getElementById('emptyClocks');
        const clocksGrid = document.getElementById('worldClocksGrid');
        emptyClocks.style.display = 'block';
        clocksGrid.style.display = 'none';
      }
      
      showMessage('World clock removed', 'info');
    }

    // Initialize meeting planner
    function initMeetingPlanner() {
      // Set meeting time to next hour if not set
      if (!appState.meetingTime) {
        const nextHour = new Date();
        nextHour.setHours(nextHour.getHours() + 1);
        nextHour.setMinutes(0, 0, 0);
        const localDateTime = new Date(nextHour.getTime() - nextHour.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
        document.getElementById('meetingTime').value = localDateTime;
        appState.meetingTime = nextHour;
      } else {
        const date = new Date(appState.meetingTime);
        const localDateTime = new Date(date.getTime() - date.getTimezoneOffset() * 60000).toISOString().slice(0, 16);
        document.getElementById('meetingTime').value = localDateTime;
      }
      
      updateMeetingParticipants();
    }

    // Update meeting participants
    function updateMeetingParticipants() {
      const container = document.getElementById('meetingParticipants');
      container.innerHTML = '';
      
      appState.meetingParticipants.forEach((tzId, index) => {
        const tz = timezones.find(t => t.id === tzId);
        if (!tz) return;
        
        const participant = document.createElement('div');
        participant.className = 'participant-card';
        participant.innerHTML = `
          <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
            <div class="timezone-flag">${tz.flag}</div>
            <button class="btn btn-icon btn-secondary" style="padding: 4px; font-size: 0.8rem;" onclick="removeMeetingParticipant(${index})">
              <i class="fas fa-times"></i>
            </button>
          </div>
          <div style="font-weight: 600; color: var(--dark); margin-bottom: 5px;">${tz.cities[0]}</div>
          <div class="participant-time" id="meetingTime${index}">--:-- --</div>
          <div class="participant-timezone">UTC${formatOffset(tz.offset)}</div>
        `;
        container.appendChild(participant);
      });
      
      // Calculate meeting times
      calculateMeetingTimes();
    }

    // Add meeting participant
    function addMeetingParticipant() {
      const availableTimezones = timezones.filter(tz => 
        !appState.meetingParticipants.includes(tz.id)
      );
      
      if (availableTimezones.length === 0) {
        showMessage('All timezones already added', 'warning');
        return;
      }
      
      const tzList = availableTimezones.map((tz, i) => 
        `${i + 1}. ${tz.cities[0]} (UTC${formatOffset(tz.offset)})`
      ).join('\n');
      
      const selection = prompt(`Select a timezone to add:\n\n${tzList}\n\nEnter number (1-${availableTimezones.length}):`);
      const index = parseInt(selection) - 1;
      
      if (index >= 0 && index < availableTimezones.length) {
        const selectedTz = availableTimezones[index];
        appState.meetingParticipants.push(selectedTz.id);
        saveState();
        updateMeetingParticipants();
        showMessage(`Added ${selectedTz.cities[0]} to meeting`, 'success');
      }
    }

    // Remove meeting participant
    function removeMeetingParticipant(index) {
      appState.meetingParticipants.splice(index, 1);
      saveState();
      updateMeetingParticipants();
      showMessage('Participant removed', 'info');
    }

    // Calculate meeting times
    function calculateMeetingTimes() {
      const meetingTimeInput = document.getElementById('meetingTime').value;
      const duration = parseInt(document.getElementById('meetingDuration').value);
      
      if (!meetingTimeInput) return;
      
      const meetingDate = new Date(meetingTimeInput);
      appState.meetingTime = meetingDate;
      
      // Calculate end time
      const endDate = new Date(meetingDate.getTime() + duration * 60000);
      
      // Update each participant's time
      appState.meetingParticipants.forEach((tzId, index) => {
        const tz = timezones.find(t => t.id === tzId);
        if (!tz) return;
        
        // Calculate time in this timezone
        const tzDate = new Date(meetingDate.getTime() + (tz.offset * 60 - meetingDate.getTimezoneOffset() / 60) * 60000);
        const timeStr = tzDate.toLocaleTimeString('en-US', { 
          hour12: true, 
          hour: '2-digit', 
          minute: '2-digit'
        });
        
        const element = document.getElementById(`meetingTime${index}`);
        if (element) {
          element.textContent = timeStr;
        }
      });
      
      saveState();
    }

    // Initialize timezone map
    function initTimezoneMap() {
      updateTimezoneMap();
    }

    // Update timezone map
    function updateTimezoneMap() {
      const container = document.getElementById('worldMap');
      container.innerHTML = '';
      
      // Add timezone markers
      timezones.forEach(tz => {
        const marker = document.createElement('div');
        marker.className = 'timezone-marker';
        
        if (tz.id === appState.fromTimezone || tz.id === appState.toTimezone) {
          marker.classList.add('active');
          marker.style.backgroundColor = '#2563eb';
        } else if (appState.worldClocks.includes(tz.id) || appState.meetingParticipants.includes(tz.id)) {
          marker.style.backgroundColor = '#10b981';
        } else {
          marker.style.backgroundColor = '#f59e0b';
        }
        
        marker.style.left = `${tz.coords.x}%`;
        marker.style.top = `${tz.coords.y}%`;
        marker.title = `${tz.cities[0]} (UTC${formatOffset(tz.offset)})`;
        
        marker.addEventListener('click', () => {
          // Simple toggle between from and to
          if (appState.fromTimezone === tz.id) {
            selectTimezone(tz.id, 'to');
          } else {
            selectTimezone(tz.id, 'from');
          }
        });
        
        container.appendChild(marker);
      });
    }

    // Set up event listeners
    function setupEventListeners() {
      // Convert now button
      document.getElementById('convertNow').addEventListener('click', performConversion);
      
      // Swap timezones
      document.getElementById('swapTimezones').addEventListener('click', swapTimezones);
      document.getElementById('swapButton').addEventListener('click', swapTimezones);
      
      // Time change
      document.getElementById('conversionTime').addEventListener('change', performConversion);
      
      // Add world clock
      document.getElementById('addClock').addEventListener('click', addWorldClock);
      document.getElementById('addFirstClock').addEventListener('click', addWorldClock);
      
      // Meeting planner
      document.getElementById('meetingTime').addEventListener('change', calculateMeetingTimes);
      document.getElementById('meetingDuration').addEventListener('change', calculateMeetingTimes);
      document.getElementById('addParticipant').addEventListener('click', addMeetingParticipant);
      document.getElementById('calculateMeeting').addEventListener('click', calculateMeetingTimes);
      document.getElementById('clearMeeting').addEventListener('click', clearMeeting);
      
      // Refresh map
      document.getElementById('refreshMap').addEventListener('click', updateTimezoneMap);
    }

    // Swap timezones
    function swapTimezones() {
      const temp = appState.fromTimezone;
      appState.fromTimezone = appState.toTimezone;
      appState.toTimezone = temp;
      
      // Update UI
      populateTimezoneList('fromTimezoneList', 'from', appState.fromTimezone);
      populateTimezoneList('toTimezoneList', 'to', appState.toTimezone);
      
      // Perform conversion with swapped timezones
      performConversion();
      showMessage('Timezones swapped', 'success');
    }

    // Clear meeting planner
    function clearMeeting() {
      appState.meetingParticipants = [];
      saveState();
      updateMeetingParticipants();
      showMessage('Meeting cleared', 'info');
    }

    // Save state to localStorage
    function saveState() {
      localStorage.setItem('timezoneConverterState', JSON.stringify(appState));
    }

    // Show message
    function showMessage(text, type) {
      // Remove existing message if any
      const existingMessage = document.querySelector('.message');
      if (existingMessage) {
        existingMessage.remove();
      }
      
      const message = document.createElement('div');
      message.className = `message ${type}`;
      message.textContent = text;
      message.style.cssText = `
        position: fixed;
        bottom: 20px;
        right: 20px;
        padding: 15px 20px;
        border-radius: 8px;
        color: white;
        font-weight: 600;
        z-index: 1000;
        animation: slideIn 0.3s ease;
      `;
      
      // Set background color based on type
      if (type === 'success') {
        message.style.backgroundColor = '#10b981';
      } else if (type === 'warning') {
        message.style.backgroundColor = '#f59e0b';
      } else if (type === 'info') {
        message.style.backgroundColor = '#2563eb';
      } else {
        message.style.backgroundColor = '#ef4444';
      }
      
      document.body.appendChild(message);
      
      // Remove after 3 seconds
      setTimeout(() => {
        if (message.parentNode) {
          message.style.animation = 'slideOut 0.3s ease';
          setTimeout(() => {
            if (message.parentNode) {
              message.remove();
            }
          }, 300);
        }
      }, 3000);
      
      // Add CSS for animations
      if (!document.querySelector('#message-styles')) {
        const style = document.createElement('style');
        style.id = 'message-styles';
        style.textContent = `
          @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
          }
          @keyframes slideOut {
            from { transform: translateX(0); opacity: 1; }
            to { transform: translateX(100%); opacity: 0; }
          }
        `;
        document.head.appendChild(style);
      }
    }

    // Initialize app when page loads
    document.addEventListener('DOMContentLoaded', initApp);
  </script>
</body>
</html>