<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Digital Lie Detector ‚Äì Advanced</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
:root {
  --bg:#020617;
  --panel:#0b1220;
  --text:#e5e7eb;
  --muted:#94a3b8;
  --safe:#22c55e;
  --warn:#f59e0b;
  --danger:#ef4444;
}

* { box-sizing:border-box; font-family:system-ui; }

body {
  margin:0;
  background:radial-gradient(circle at top,#0f172a,#020617);
  color:var(--text);
  min-height:100vh;
  display:flex;
  align-items:center;
  justify-content:center;
}

.panel {
  width:95%;
  max-width:600px;
  background:var(--panel);
  padding:28px;
  border-radius:18px;
  box-shadow:0 30px 80px rgba(0,0,0,.7);
}

h1 { text-align:center; margin-bottom:6px; }
.sub { text-align:center; color:var(--muted); font-size:.9rem; }

.question {
  margin-top:22px;
  font-size:1.05rem;
}

textarea {
  width:100%;
  margin-top:10px;
  background:#020617;
  color:var(--text);
  border:1px solid #1e293b;
  border-radius:12px;
  padding:12px;
  min-height:90px;
  resize:none;
}

button {
  width:100%;
  margin-top:18px;
  padding:12px;
  background:linear-gradient(135deg,#2563eb,#3b82f6);
  border:none;
  border-radius:12px;
  color:white;
  font-size:1rem;
  cursor:pointer;
}

.meter {
  margin-top:20px;
  height:10px;
  background:#020617;
  border-radius:10px;
  overflow:hidden;
}

.meter-fill {
  height:100%;
  width:100%;
  background:var(--safe);
  transition:.3s;
}

.result {
  margin-top:22px;
  padding:16px;
  border-radius:12px;
  display:none;
}

.safe { background:rgba(34,197,94,.15); border-left:4px solid var(--safe);}
.warn { background:rgba(245,158,11,.15); border-left:4px solid var(--warn);}
.danger { background:rgba(239,68,68,.15); border-left:4px solid var(--danger);}

.metrics {
  margin-top:10px;
  font-size:.85rem;
  color:var(--muted);
}

footer {
  margin-top:18px;
  font-size:.75rem;
  color:var(--muted);
  text-align:center;
}
</style>
</head>

<body>
<div class="panel">
  <h1>Digital Lie Detector</h1>
  <div class="sub">Behavioral & voice-based inference (not a truth machine)</div>

  <div class="question">
    Did you complete this task honestly and independently?
  </div>

  <textarea id="input"></textarea>

  <div class="meter">
    <div class="meter-fill" id="confidence"></div>
  </div>

  <button onclick="analyze()">Analyze</button>

  <div class="result" id="result"></div>

  <footer>
    ‚ö† This system analyzes interaction patterns, not intent.
  </footer>
</div>

<script>
const input = document.getElementById("input");
const confidence = document.getElementById("confidence");

let start=null, back=0, changes=0, focusLoss=0, idle=0;
let last="", lastKey=null, gaps=[];
let idleTimer;

document.addEventListener("visibilitychange",()=>{
  if(document.hidden) focusLoss++;
});

input.addEventListener("keydown",e=>{
  if(!start) start=Date.now();
  if(e.key==="Backspace") back++;

  const now=Date.now();
  if(lastKey) gaps.push(now-lastKey);
  lastKey=now;

  clearTimeout(idleTimer);
  idleTimer=setTimeout(()=>idle++,1500);
});

input.addEventListener("input",()=>{
  if(last && input.value!==last) changes++;
  last=input.value;
});

navigator.mediaDevices.getUserMedia({audio:true}).then(stream=>{
  const ctx=new AudioContext();
  const mic=ctx.createMediaStreamSource(stream);
  const analyser=ctx.createAnalyser();
  mic.connect(analyser);
  const data=new Uint8Array(analyser.frequencyBinCount);

  setInterval(()=>{
    analyser.getByteFrequencyData(data);
    const avg=data.reduce((a,b)=>a+b,0)/data.length;
    if(avg<8) idle++;
  },2000);
}).catch(()=>{});

function analyze(){
  const time=(Date.now()-start)/1000;
  const avgGap=gaps.reduce((a,b)=>a+b,0)/gaps.length||0;

  let score=0;
  if(time>10) score+=2;
  if(back>5) score+=2;
  if(changes>3) score+=2;
  if(avgGap>600) score+=2;
  if(focusLoss>0) score+=2;
  if(idle>3) score+=2;

  const conf=Math.max(5,100-score*10);
  confidence.style.width=conf+"%";
  confidence.style.background=conf>70?"var(--safe)":conf>40?"var(--warn)":"var(--danger)";

  const res=document.getElementById("result");
  res.style.display="block";

  if(conf>70){
    res.className="result safe";
    res.innerHTML="<b>High Confidence</b><p>Response appears consistent and natural.</p>";
  } else if(conf>40){
    res.className="result warn";
    res.innerHTML="<b>Moderate Uncertainty</b><p>Hesitation and correction detected.</p>";
  } else {
    res.className="result danger";
    res.innerHTML="<b>High Deception Indicators</b><p>Strong hesitation patterns observed.</p>";
  }

  res.innerHTML+=`
  <div class="metrics">
  ‚è± ${time.toFixed(1)}s | ‚å´ ${back} | ‚úèÔ∏è ${changes} | üëÄ Focus loss ${focusLoss}<br>
  ‚å®Ô∏è Avg gap ${Math.round(avgGap)}ms | üé§ Idle signals ${idle}
  </div>`;
}
</script>
</body>
</html>
